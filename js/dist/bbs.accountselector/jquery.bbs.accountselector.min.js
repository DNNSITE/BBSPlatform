!function(e){var l,t={localzRes:{anonymousPersonFldDisplayNameTitle:"Display Name",anonymousPersonFldEmailTitle:"Email",anonymousPersonFldPhoneTitle:"Phone",organizationTabText:"Organization",organizationFldSelectorTitle:"Organization",organizationFldContactSelectorTitle:"Contacts",organizationFldSelectorPlaceholderText:"Select organization...",organizationFldContactSelectorPlaceholderText:"Select contacts...",personTabTitle:"Person",personFldSelectorPlaceholderText:"Select contacts...",personFldSelectorTitle:"User",defVal:null},modId:"",listSrcUrl:"",organizationSelectEnable:!0,personSelectEnable:!0,anonymousPersonSelectEnable:!1,defaultActive:"person",minimumResultsForSearch:10,onChange:function(){}},a={init:function(a){return l=e.extend({},t,a),this.each(function(){s=e(this).attr("id"),o()})},getValue:function(e){return g(e)},clearValue:function(){clearFile()}};e.fn.bbsAccountSelector=function(l){return a[l]?a[l].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof l&&l?void e.error("Method "+l+" does not exist on jQuery.bbsAccountSelector"):a.init.apply(this,arguments)};var s,o=function(){var t="",a=e("#"+s),o=l.defaultActive,f=l.defVal,g="",y="",S="",h="",I="";null!=f&&"object"==typeof f&&("organization"==f.type?(g=f.accid,y=JSON.stringify(f.contacts)):"user"==f.type?g=f.accid:"anonymous"==f.type&&(S=f.anonymousMeta.displayname,h=f.anonymousMeta.email,I=f.anonymousMeta.phone)),"organization"!=o||0!=l.organizationSelectEnable&&1!=l.anonymousPersonSelectEnable||(o="person"),"person"==o&&0==l.personSelectEnable&&0==l.anonymousPersonSelectEnable&&(o="organization"),(1==l.organizationSelectEnable||1==l.personSelectEnable||1==l.anonymousPersonSelectEnable)&&(t+='<div id="navAccountPane'+l.modId+'" class="tab-container tab-default bbs-accountselector">',t+='<ul id="navAccountTabPane'+l.modId+'" class="nav nav-tabs">',t+='<li class="dropdown pull-right tabdrop hide"><a class="dropdown-toggle" data-toggle="dropdown" href="#"><i class="fa fa-angle-down"></i></a><ul class="dropdown-menu"></ul></li>',1==l.organizationSelectEnable&&0==l.anonymousPersonSelectEnable&&(t+="<li"+("organization"==o?' class="active"':"")+'><a href="#navAccountDealerTab'+l.modId+'" data-toggle="tab"><i class="fa fa-building"></i> '+l.localzRes.organizationTabText+"</a></li>"),(1==l.personSelectEnable||1==l.anonymousPersonSelectEnable)&&(t+="<li"+("person"==o?' class="active"':"")+'><a href="#navAccountUserTab'+l.modId+'" data-toggle="tab"><i class="fa fa-user"></i> '+l.localzRes.personTabTitle+"</a></li>"),t+="</ul>",t+='<div class="tab-content">',1==l.organizationSelectEnable&&0==l.anonymousPersonSelectEnable&&(t+='<div class="sky-form tab-pane'+("organization"==o?" active":"")+'" id="navAccountDealerTab'+l.modId+'">',t+="<fieldset>",t+='<div class="row">',t+='<div class="col-md-6">',t+="<section>",t+='<label class="label">'+l.localzRes.organizationFldSelectorTitle+"</label>",t+='<label class="select select2-single-autoheight">',t+='<select id="frmDealerAccountGUID'+l.modId+'" name="frmDealerAccountGUID'+l.modId+'" class="form-control select2-single" data-val="'+g+'"></select>',t+="</label>",t+="</section>",t+="</div>",t+='<div class="col-md-6">',t+="<section>",t+='<label class="label">'+l.localzRes.organizationFldContactSelectorTitle+"</label>",t+='<label class="select">',t+='<select id="frmDealerContactUsers'+l.modId+'" name="frmDealerContactUsers'+l.modId+'" class="form-control select2-multiple" multiple disabled="disabled" data-val=\''+y+"'></select>",t+="</label>",t+="</section>",t+="</div>",t+="</div>",t+="</fieldset>",t+="</div>"),(1==l.personSelectEnable||1==l.anonymousPersonSelectEnable)&&(t+='<div class="sky-form tab-pane'+("person"==o?" active":"")+'" id="navAccountUserTab'+l.modId+'">',t+="<fieldset>",t+='<div class="row">',0==l.anonymousPersonSelectEnable?(t+='<div class="col-md-6">',t+="<section>",t+='<label class="label">'+l.localzRes.personFldSelectorTitle+"</label>",t+='<label class="select select2-single-autoheight">',t+='<select id="frmUserAccountGUID'+l.modId+'" name="frmUserAccountGUID'+l.modId+'" class="form-control select2-single" data-val="'+g+'"></select>',t+="</label>",t+="</section>",t+="</div>",t+='<div class="col-md-6">',t+="</div>"):(t+='<div class="col-md-6">',t+="<section>",t+='<label class="label">'+l.localzRes.anonymousPersonFldDisplayNameTitle+"</label>",t+='<label class="input">',t+='<input name="frmDisplayName'+l.modId+'" id="frmDisplayName'+l.modId+'" type="text" maxlength="80"'+(""!=S?' value="'+S+'"':"")+">",t+="</label>",t+="</section>",t+="<section>",t+='<label class="label">'+l.localzRes.anonymousPersonFldEmailTitle+"</label>",t+='<label class="input">',t+='<input name="frmEmail'+l.modId+'" id="frmEmail'+l.modId+'" type="text" maxlength="120" '+(""!=h?' value="'+h+'"':"")+">",t+="</label>",t+="</section>",t+="<section>",t+='<label class="label">'+l.localzRes.anonymousPersonFldPhoneTitle+"</label>",t+='<label class="input">',t+='<input name="frmPhone'+l.modId+'" id="frmPhone'+l.modId+'" type="text" maxlength="20"'+(""!=I?' value="'+I+'"':"")+">",t+="</label>",t+="</section>",t+="</div>",t+='<div class="col-md-6">',t+="</div>"),t+="</div>",t+="</fieldset>",t+="</div>"),t+="</div>"),a.replaceWith(t),e("#frmDealerAccountGUID"+l.modId).select2({theme:"bootstrap",hideSelectionFromResult:b,escapeMarkup:function(e){return e},minimumResultsForSearch:l.minimumResultsForSearch,placeholder:l.localzRes.organizationFldSelectorPlaceholderText,templateResult:c,templateSelection:d}),e("#frmDealerContactUsers"+l.modId).select2({theme:"bootstrap",allowClear:!1,hideSelectionFromResult:b,escapeMarkup:function(e){return e},placeholder:l.localzRes.personFldSelectorPlaceholderText,templateResult:m,templateSelection:u}),e("#frmUserAccountGUID"+l.modId).select2({theme:"bootstrap",escapeMarkup:function(e){return e},minimumResultsForSearch:l.minimumResultsForSearch,placeholder:l.localzRes.personFldSelectorPlaceholderText,templateResult:p,templateSelection:v}),i(),r(),e("#frmDealerAccountGUID"+l.modId).on("change",function(){var t,a=(l.dealerInfoBoxTemlate,e(this).find(":selected").data("meta"));null!=a&&"object"==typeof a&&(t=a.id),e(this).data("val",e(this).val()),e("#frmDealerContactUsers"+l.modId).data("val",""),e("#frmDealerContactUsers"+l.modId).val("").trigger("change"),n(t)}),e("#frmDealerContactUsers"+l.modId).on("change",function(){e(this).data("val",e(this).val())})},i=function(){var t="#frmDealerAccountGUID"+l.modId;e(t).html(""),f={srcname:"getdealerlistbyuser"},dVal=e(t).data("val"),isSel=!1;var a=[{id:"7f0fe6fc-7c90-4fe8-a7c8-34ec1508a443",title:"Базовый электрод ООО",logourl:"assets/img/8.png",officeaddress:"Россия, Москва, 23КМ МКАД, д.1"},{id:"7f0fe6fc-7c90-4fe8-a7c8-34ec1508a444",title:"Красный лесоруб ООО",logourl:"assets/img/2.png",officeaddress:"Россия, Черноморск, Кривоколенный пер., д.123"}];e(t).append('<option value="">&nbsp;</option>'),e.map(a,function(l){l.id==dVal&&0==isSel&&(isSel=!0),e(t).append('<option value="'+l.id+"\" data-meta='"+JSON.stringify(l)+"'"+(l.id==dVal?' selected="selected"':"")+">"+l.title+"</option>")}),(isSel=!0)&&n(dVal)},n=function(t){var a="#frmDealerContactUsers"+l.modId;if(e(a).html(""),f={srcname:"getdealerlistbyuser"},dVal=e(a).data("val"),isSel=!1,!t||""==t)return void e(a).prop("disabled",!0);var s=[{id:"1",fullname:"Иванов Иван Иванович",logourl:"assets/img/1.png",jobtitle:"Директор"},{id:"2",fullname:"Петров Виталий Федорович",logourl:"assets/img/2.png",jobtitle:"Бухгалтер"},{id:"3",fullname:"Сидоров Степан Петрович",logourl:"assets/img/3.png",jobtitle:"Завхоз"},{id:"4",fullname:"Ладыженский Евгений Николаевич",logourl:"assets/img/4.png",jobtitle:"Заместитель бухгалтера"}];e(a).prop("disabled",!1),e(a).append('<option value="">&nbsp;</option>'),e.map(s,function(l){isSel=!1,null!=dVal&&e.each(dVal,function(e,t){return l.id==t?(isSel=!0,!1):void 0}),e(a).append('<option value="'+l.id+"\" data-meta='"+JSON.stringify(l)+"'"+(1==isSel?' selected="selected"':"")+">"+l.fullname+"</option>")})},r=function(){var t="#frmUserAccountGUID"+l.modId;e(t).html(""),f={srcname:"getfriendlistbyuser"},dVal=e(t).data("val"),isSel=!1;var a=[{id:"7f0fe6fc-7c90-4fe8-a7c8-34ec1508a446",fullname:"Иванов Иван Иванович",logourl:"assets/img/1.png",jobtitle:"Директор"},{id:"7f0fe6fc-7c90-4fe8-a7c8-34ec1508a447",fullname:"Петров Виталий Федорович",logourl:"assets/img/2.png",jobtitle:"Бухгалтер"},{id:"7f0fe6fc-7c90-4fe8-a7c8-34ec1508a448",fullname:"Сидоров Степан Петрович",logourl:"assets/img/3.png",jobtitle:"Завхоз"},{id:"7f0fe6fc-7c90-4fe8-a7c8-34ec1508a449",fullname:"Ладыженский Евгений Николаевич",logourl:"assets/img/4.png",jobtitle:"Заместитель бухгалтера"}];e(t).prop("disabled",!1),e(t).append('<option value="">&nbsp;</option>'),e.map(a,function(l){l.id==dVal&&0==isSel&&(isSel=!0),e(t).append('<option value="'+l.id+"\" data-meta='"+JSON.stringify(l)+"'"+(l.id==dVal?' selected="selected"':"")+">"+l.fullname+"</option>")})},c=function(l){if(!l.id)return l.text;var t=e(l.element).data("meta"),a='<div class="select2-result-repository clearfix"><div class="select2-result-repository__avatar"><img src="'+t.logourl+'" class="img-sm img-circle"/></div><div class="select2-result-repository__meta"><div class="select2-result-repository__title">'+t.title+"</div>";return t.officeaddress&&(a+="<div class='select2-result-repository__subtitle'>"+t.officeaddress+"</div>"),a+="</div>"},d=function(l){var t=e(l.element).data("meta");if(!t||"object"!=typeof t)return l.text;var a='<div class="select2-result-repository clearfix"><div class="select2-result-repository__avatar"><img src="'+t.logourl+'" class="img-sm img-circle"/></div><div class="select2-result-repository__meta"><div class="select2-result-repository__title">'+t.title+"</div>";return t.officeaddress&&(a+="<div class='select2-result-repository__subtitle'>"+t.officeaddress+"</div>"),a+="</div>"},m=function(l){if(!l.id)return l.text;var t=e(l.element).data("meta"),a='<div class="select2-result-repository clearfix"><div class="select2-result-repository__avatar"><img src="'+t.logourl+'" class="img-sm img-circle"/></div><div class="select2-result-repository__meta"><div class="select2-result-repository__title">'+t.fullname+"</div>";return t.jobtitle&&(a+="<div class='select2-result-repository__subtitle'>"+t.jobtitle+"</div>"),a+="</div>"},u=function(l){if(!l.id)return l.text;var t=e(l.element).data("meta"),a='<div class="select2-result-repository clearfix"><div class="select2-result-repository__avatar"><img src="'+t.logourl+'" class="img-sm img-circle"/></div><div class="select2-result-repository__meta"><div class="select2-result-repository__title">'+t.fullname+"</div>";return t.jobtitle&&(a+="<div class='select2-result-repository__subtitle'>"+t.jobtitle+"</div>"),a+="</div>"},p=function(l){if(!l.id)return l.text;var t=e(l.element).data("meta"),a='<div class="select2-result-repository clearfix"><div class="select2-result-repository__avatar"><img src="'+t.logourl+'" class="img-sm img-circle"/></div><div class="select2-result-repository__meta"><div class="select2-result-repository__title">'+t.fullname+"</div>";return t.jobtitle&&(a+="<div class='select2-result-repository__subtitle'>"+t.jobtitle+"</div>"),a+="</div>"},v=function(l){if(!l.id)return l.text;var t=e(l.element).data("meta"),a='<div class="select2-result-repository clearfix"><div class="select2-result-repository__avatar"><img src="'+t.logourl+'" class="img-sm img-circle"/></div><div class="select2-result-repository__meta"><div class="select2-result-repository__title">'+t.fullname+"</div>";return t.jobtitle&&(a+="<div class='select2-result-repository__subtitle'>"+t.jobtitle+"</div>"),a+="</div>"},b=function(e){return!1},g=function(t){var a,s="",o="",i="",n="",r="",c="";return e("ul#navAccountTabPane"+l.modId+" li.active a").attr("href")=="#navAccountDealerTab"+l.modId?(s="organization",o=e("#frmDealerAccountGUID"+l.modId).data("val"),i=JSON.stringify(e("#frmDealerContactUsers"+l.modId).data("val")),null==o&&(o=""),null==i&&(i=""),a={type:s,accid:o,contacts:i}):1==l.anonymousPersonSelectEnable?(s="anonymous",n=e("#frmDisplayName"+l.modId).val(),r=e("#frmEmail"+l.modId).val(),c=e("#frmPhone"+l.modId).val(),a={type:s,anonymousMeta:{displayname:n,email:r,phone:c}}):(s="user",o=e("#frmUserAccountGUID"+l.modId).val(),a={type:s,accid:o}),a}}(jQuery);